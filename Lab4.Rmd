---
title: "CNN Smartphone Sensor Dataset - Andrew Filiberti & Edward Brunton"
output: html_notebook
---

```{r}
#devtools::install_github("rstudio/keras")
```


```{r}
library(keras)
```

```{r}
x_train_in = read.table(file = "UCI HAR Dataset/train/X_train.txt", sep = "" , header = F , na.strings ="", stringsAsFactors= F)

y_train_in = read.table(file = "UCI HAR Dataset/train/y_train.txt", sep = "" , header = F , na.strings ="", stringsAsFactors= F)

x_test_in = read.table(file = "UCI HAR Dataset/test/X_test.txt", sep = "" , header = F , na.strings ="", stringsAsFactors= F)

y_test_in = read.table(file = "UCI HAR Dataset/test/y_test.txt", sep = "" , header = F , na.strings ="", stringsAsFactors= F)
```

```{r}
head(x_train_in)
```

```{r}
#convert y in useable data
y_test <- y_test_in -1
y_train <- y_train_in -1
y_test<-as.array(y_test[,1])
y_train<-as.array(y_train[,1])
```

```{r}
dim(y_train)
dim(y_test)
```


```{r}
x_train <- (x_train_in +1)/2
x_train <- matrix(unlist(x_train), ncol = 561, byrow = TRUE)
x_train <- array_reshape(x_train,
                        c(nrow(x_train),
                          561,
                          1))
x_test <- (x_test_in + 1)/2
x_test <- matrix(unlist(x_test), ncol = 561, byrow = TRUE)
x_test <- array_reshape(x_test,
                        c(nrow(x_test),
                          561,
                          1))

input_shape <- c(561, 1)
dim(x_train)
dim(x_test)
```

```{r}
input_shape <- c(561,1)
num_classes <-5
head(y_train)
model <- keras_model_sequential() %>%
  layer_conv_1d(filters = 128,
                kernel_size = c(3),
                activation = 'relu',
                input_shape = input_shape) %>% 
  layer_dropout(rate = 0.25) %>% 
  layer_flatten() %>% 
  layer_dense(units = 64,
              activation = 'relu') %>% 
  layer_dropout(rate = 0.5) %>% 
  layer_dense(units = num_classes,
              activation = 'softmax')
```

```{r}
model %>% compile(
  loss = loss_categorical_crossentropy,
  optimizer = optimizer_adadelta(),
  metrics = c('accuracy')
)
```



```{r}
batch_size <- 64
epochs <- 15

# Train model
model %>% fit(
  x_train, y_train,
  batch_size = batch_size,
  epochs = epochs,
  validation_split = 0.2
)
score <- model %>% evaluate(x_test,
                            y_test)

cat('Test loss: ', score$loss, "\n")
cat('Test accuracy: ', score$acc, "\n")
```

```
a) Description of model architecture
  We used the keras package to implement our model. The dataset was split into training and testing sets, and then was situated into the right format for our CNN model. The function that we used created a 1-dimensional CNN, for the data that we were using was 1-dimensional. 


b) Results Evaluation




c) Learning in the past 2 weeks



```

